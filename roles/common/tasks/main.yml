---
# This playbook install all the necessary packages for Domjudge
- name: Installing the necessary Software
  apt:
    name: "{{ item }}"
    state: latest 
    update_cache: yes
  loop:
    - libcgroup-dev
    - make
    - acl
    - zip
    - unzip
    - mariadb-server
    - apache2
    - php
    - php-fpm
    - php-gd
    - php-cli
    - php-intl
    - php-mbstring
    - php-mysql
    - php-curl
    - php-json
    - php-xml
    - php-zip
    - composer
    - ntp
    - gcc
    - pkg-config
    - build-essential
    - python3-mysqldb
    - debootstrap
    - lsof
    - procps
    - python3-yaml

- name: Removing apport to resolve possible conflicts with judging
  ansible.builtin.package:
    name: apport
    state: absent
    update_cache: yes

- name: Detect installed php version
  ansible.builtin.shell: "php -r 'echo PHP_MAJOR_VERSION.\".\".PHP_MINOR_VERSION;'"
  register: php_version_output

- name: Set php version facts 
  ansible.builtin.set_fact:
    php_version: "{{ php_version_output.stdout }}"
  
